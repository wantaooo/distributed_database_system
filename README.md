# 分布式数据库系统

此项目实现了一个小型分布式数据库，完整地包含了多版本并发控制、死锁检测、复制和故障恢复。


## 使用jar文件运行此项目
可以通过项目根目录下的jar文件直接运行此应用程序。

我们已经在 TestInput目录下创建了一些测试用例。你可以通过提供与项目根路径相关的测试输入文件路径，来一次性运行其中的任何一个。

首先，确保当前在项目的根目录下：..../adb-repcrec/

然后，如果想测试第三个测试用例，可以直接运行：

```
java -jar adb-repcrec-all-1.0-SNAPSHOT.jar ./TestInput/test3.txt
```

执行该命令后，程序将开始运行，可以在控制台和输出文件中查看结果。

输出将自动生成在项目根路径下的TestOutput目录中。

## 使用gradle运行此项目

如果你的机器上安装了gradle，也可以选择使用gradle来运行此项目。例如，如果想运行第一个测试用例，可以简单地运行以下命令：

```$xslt
./gradlew run --args='./TestInput/test1.txt'
```
## 算法

1. 我们使用严格的两阶段锁（使用读锁和写锁）进行分布式读写控制。

2. 此数据库系统以FIFS （First-in-first-serve 先到先得）的方式获取锁

3. 只读事务应使用多版本读取一致性。

4. 我们使用深度优先搜索（DFS）来检测死锁循环，并终止最早的事务。

## 注意事项

1. 我们将确保在事务等待时，不会接收到其他操作。

2. 此项目的应用程序能够防止写饥饿问题。例如，如果请求按以下顺序到达：R(T1,x)，R(T2,x)，W(T3,x,73)，R(T4,x)，那么，假设没有事务被中止，首先 T1 和 T2 将共享 x 的读锁，然后 T3 会获得 x 的写锁，最后 T4 会获得 x 的读锁。注意，T4 不会跳过 T3，因为那样可能会导致写操作饥饿。

## 附录
1. Concurrency Control and Recovery in Database Systems by Bernstein, Hadzilacos, and Goodman, Addison-Wesley

2. 纽约大学计算机科学研究生课程：高级数据库系统

